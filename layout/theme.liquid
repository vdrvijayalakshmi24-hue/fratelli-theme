<!doctype html>

<html class="no-js" lang="{{ shop.locale }}">
  <head>
    <meta charset="utf-8"> 
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, height=device-height, minimum-scale=1.0, maximum-scale=1.0">
    <meta name="theme-color" content="{{ settings.accent_color }}">
    <meta name="facebook-domain-verification" content="f7cq4hq8kdks12wuzcbj23u9wkagan" />
    <title>
      {{ page_title }}{% if current_tags %}{% assign meta_tags = current_tags | join: ', ' %} &ndash; {{ 'general.meta.tags' | t: tags: meta_tags }}{% endif %}{% if current_page != 1 %} &ndash; {{ 'general.meta.page' | t: page: current_page }}{% endif %}{% unless page_title contains shop.name %} &ndash; {{ shop.name }}{% endunless %}
    </title>
    <style>
      html.lenis { height: auto; overflow: hidden; }
      .lenis.lenis-smooth { scroll-behavior: auto; }
      .lenis.lenis-stopped { overflow: hidden; }
      [data-lenis-prevent] { overscroll-behavior: contain; -webkit-overflow-scrolling: touch; }
      body { touch-action: pan-y pinch-zoom; }
    </style>
    {%- if page_description -%}
      <meta name="description" content="{{ page_description | escape }}">
    {%- endif -%}

    <link rel="canonical" href="{{ canonical_url }}">

    {%- if settings.favicon -%}
      <link rel="shortcut icon" href="{{ settings.favicon | img_url: '96x' }}" type="image/png">
    {%- endif -%}

    {% render 'social-meta-tags' %}
    {% render 'css-variables' %}

    {{ content_for_header }}
  {% include 'tipo.booking.script' %}
  
    <!-- GSAP Animation Library -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/ScrollTrigger.min.js"></script>
    <script src="https://unpkg.com/lenis@1.3.11/dist/lenis.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/scrolly-video@latest/dist/scrolly-video.js"></script>
    <script>
      // Initialize GSAP and register plugins
      if (window.gsap) {
        try {
          gsap.registerPlugin(ScrollTrigger);
          
        } catch (e) {
          console.error('Error initializing GSAP utilities:', e);
        }
      } else {
        console.warn('GSAP not available. Some animations may not work.');
      }
    </script>

    
<!-- Lenis (CDN) -->
<script src="https://cdn.jsdelivr.net/gh/studio-freight/lenis@latest/bundled/lenis.min.js"></script>

<script>
(function () {
  // === DEVICE DETECTION & USER PREFERENCE SAFEGUARDS ===
  var isTouch = ('ontouchstart' in window) || (navigator.maxTouchPoints && navigator.maxTouchPoints > 0) || (navigator.msMaxTouchPoints && navigator.msMaxTouchPoints > 0);
  var prefersReduced = window.matchMedia && window.matchMedia('(prefers-reduced-motion: reduce)').matches;

  // If you want to *force* native scroll on small screens, set this to false.
  // Useful if smoothing causes jank on very low-end devices.
  var enableMobileSmoothing = true;

  // === TUNED CONFIG (different for desktop vs mobile) ===
  var desktopConfig = {
    smooth: true,
    direction: 'vertical',
    autoRaf: true,
    duration: 1.5,
    smoothTouch: true,
    touchMultiplier: 0.7,
    smoothWheel: true,
    wheelMultiplier: 0.7,
  };

  var mobileConfig = {
    smooth: true,
    direction: 'vertical',
    autoRaf: true,
    // increase duration for slower, smoother interpolation on touch
    duration: 2.0,
    smoothTouch: true,
    // reduce multiplier so one finger swipe moves less distance (smoother)
    touchMultiplier: 2.0,
    // enable syncTouch to mimic native touch inertia (helps on newer iOS)
    syncTouch: true,
    syncTouchLerp: 0.08,
    smoothWheel: false,
    wheelMultiplier: 2.0,
  };

  var config = isTouch ? mobileConfig : desktopConfig;

  // If user prefers reduced motion, don't smooth at all
  if (prefersReduced) {
    config.smooth = false;
    config.smoothTouch = false;
  }

  // Defensive: do not init Lenis inside theme editors (Shopify editor) — optional
  var inShopifyEditor = (typeof Shopify !== 'undefined' && Shopify.designMode);
  if (inShopifyEditor) {
    // still load nothing — ensure editor uses native scroll
    window.__lenis = null;
    return;
  }

  // Initialize Lenis
  var lenis = new Lenis();
  window.__lenis = lenis; // expose for debugging / toggles from console

  // === RAF LOOP (required) ===
  function raf(time) {
    lenis.raf(time);
    requestAnimationFrame(raf);
  }
  requestAnimationFrame(raf);

  // === GSAP / ScrollTrigger INTEGRATION (if present) ===
  if (window.gsap && window.ScrollTrigger) {
    // Update ScrollTrigger when Lenis emits scroll events
    lenis.on('scroll', function () {
      try { ScrollTrigger.update(); } catch (e) {}
    });

    // Also keep ScrollTrigger in sync on RAF for perfect alignment
    try {
      gsap.ticker.add(ScrollTrigger.update);
    } catch (e) {}

    // Refresh to ensure markers & geometry compute correctly
    ScrollTrigger.refresh();
  }

  // === OPTIONAL HELPERS / RECOMMENDATIONS ===
  // 1) Containers that should NOT be smoothed (maps, native scroll areas, modals)
  //    add attribute: data-lenis-prevent
  //
  // 2) If you need to temporarily disable smoothing (e.g. full-screen modal),
  //    call: window.__lenis && window.__lenis.stop();  // or .destroy() to teardown
  //    and to resume: window.__lenis && window.__lenis.start();
  //    (Note: some Lenis builds expose start/stop; if not available, use destroy() then re-init.)
  //
  // 3) If you observe jank on very-low-end devices, set enableMobileSmoothing = false above
  //    so mobile devices use native scrolling.
  //
  // 4) Input fields: if you notice caret/scroll issues inside input/textarea while smoothing,
  //    add the attribute data-lenis-prevent to the input container or disable smoothing while focused.

  // Expose a tiny API to toggle smoothing at runtime
  window.__lenisToggle = function (on) {
    if (!window.__lenis) return;
    try {
      if (on === false) {
        if (typeof window.__lenis.stop === 'function') window.__lenis.stop();
        else if (typeof window.__lenis.destroy === 'function') window.__lenis.destroy();
      } else {
        // Simple re-init helper: if destroyed, create a new instance — keep it minimal
        // Note: re-init logic omitted for brevity; better to call location.reload() if needed.
        console.warn('To re-enable Lenis after destroy you will need to re-init or reload page.');
      }
    } catch (e) { console.warn(e); }
  };

  // Small runtime tweak: if the mobile device has very low memory, fallback to native scroll.
  // (This is conservative — you can remove this if you prefer to always attempt smoothing.)
  try {
    if (navigator.deviceMemory && navigator.deviceMemory <= 1) {
      // disable smoothing on very low memory devices
      if (lenis && typeof lenis.destroy === 'function') lenis.destroy();
      window.__lenis = null;
    }
  } catch (e) {}

})();
</script>

    
    <link rel="stylesheet" href="{{ 'theme.css' | asset_url }}">
    <link rel="stylesheet" href="{{ 'custom-header.css' | asset_url }}" type="text/css">

    <script>
      // This allows to expose several variables to the global scope, to be used in scripts
      window.theme = {
        pageType: {{ request.page_type | json }},
        moneyFormat: {{ shop.money_format | json }},
        moneyWithCurrencyFormat: {{ shop.money_with_currency_format | json }},
        productImageSize: {{ settings.product_image_size | json }},
        searchMode: {{ settings.search_mode | json }},
        showPageTransition: {{ settings.show_page_transition | json }},
        showElementStaggering: {{ settings.show_element_staggering | json }},
        showImageZooming: {{ settings.show_image_zooming | json }}
      };

      window.routes = {
        rootUrl: {{ routes.root_url | json }},
        cartUrl: {{ routes.cart_url | json }},
        cartAddUrl: {{ routes.cart_add_url | json }},
        cartChangeUrl: {{ routes.cart_change_url | json }},
        searchUrl: {{ routes.search_url | json }},
        productRecommendationsUrl: {{ routes.product_recommendations_url | json }}
      };

      window.languages = {
        cartAddNote: {{ 'cart.general.add_note' | t | json }},
        cartEditNote: {{ 'cart.general.edit_note' | t | json }},
        productImageLoadingError: {{ 'product.slideshow.image_loading_error' | t | json }},
        productFormAddToCart: {% if product.template_suffix == 'pre-order' %}{{ 'product.form.pre_order' | t | json }}{% else %}{{ 'product.form.add_to_cart' | t | json }}{% endif %},
        productFormUnavailable: {{ 'product.form.unavailable' | t | json }},
        productFormSoldOut: {{ 'product.form.sold_out' | t | json }},
        shippingEstimatorOneResult: {{ 'cart.shipping_estimator.one_result_title' | t | json }},
        shippingEstimatorMoreResults: {{ 'cart.shipping_estimator.more_results_title' | t | json }},
        shippingEstimatorNoResults: {{ 'cart.shipping_estimator.no_results_title' | t | json }}
      };

      window.lazySizesConfig = {
        loadHidden: false,
        hFac: 0.5,
        expFactor: 2,
        ricTimeout: 150,
        lazyClass: 'Image--lazyLoad',
        loadingClass: 'Image--lazyLoading',
        loadedClass: 'Image--lazyLoaded'
      };

      document.documentElement.className = document.documentElement.className.replace('no-js', 'js');
      document.documentElement.style.setProperty('--window-height', window.innerHeight + 'px');

      // We do a quick detection of some features (we could use Modernizr but for so little...)
      (function() {
        document.documentElement.className += ((window.CSS && window.CSS.supports('(position: sticky) or (position: -webkit-sticky)')) ? ' supports-sticky' : ' no-supports-sticky');
        document.documentElement.className += (window.matchMedia('(-moz-touch-enabled: 1), (hover: none)')).matches ? ' no-supports-hover' : ' supports-hover';
      }());
    </script>

    <script src="{{ 'lazysizes.min.js' | asset_url }}" async></script>

    {%- if template == 'customers/addresses' -%}
      <script src="{{ 'shopify_common.js' | shopify_asset_url }}" defer></script>
      <script src="{{ 'customer_area.js' | shopify_asset_url }}" defer></script>
    {%- endif -%}

    <script src="https://cdn.polyfill.io/v3/polyfill.min.js?unknown=polyfill&features=fetch,Element.prototype.closest,Element.prototype.remove,Element.prototype.classList,Array.prototype.includes,Array.prototype.fill,Object.assign,CustomEvent,IntersectionObserver,IntersectionObserverEntry,URL" defer></script>
    <script src="{{ 'libs.min.js' | asset_url }}" defer></script>
    <script src="{{ 'theme.min.js' | asset_url }}" defer></script>
    <script src="{{ 'custom.js' | asset_url }}" defer></script>

    <script>
      (function () {
        window.onpageshow = function() {
          if (window.theme.showPageTransition) {
            var pageTransition = document.querySelector('.PageTransition');

            if (pageTransition) {
              pageTransition.style.visibility = 'visible';
              pageTransition.style.opacity = '0';
            }
          }

          // When the page is loaded from the cache, we have to reload the cart content
          document.documentElement.dispatchEvent(new CustomEvent('cart:refresh', {
            bubbles: true
          }));
        };
      })();
    </script>
 

    {% render 'microdata-schema' %}
  </head>

  {%- capture classes -%}features--heading-{{ settings.heading_size }}{%- endcapture -%}

  {%- if settings.uppercase_heading -%}
    {%- assign classes = classes | append: ' features--heading-uppercase' -%}
  {%- endif -%}

  {%- if settings.product_show_price_on_hover -%}
    {%- assign classes = classes | append: ' features--show-price-on-hover' -%}
  {%- endif -%}

  {%- if settings.show_page_transition -%}
    {%- assign classes = classes | append: ' features--show-page-transition' -%}
  {%- endif -%}

  {%- if settings.show_button_transition -%}
    {%- assign classes = classes | append: ' features--show-button-transition' -%}
  {%- endif -%}

  {%- if settings.show_image_zooming -%}
    {%- assign classes = classes | append: ' features--show-image-zooming' -%}
  {%- endif -%}

  {%- if settings.show_element_staggering -%}
    {%- assign classes = classes | append: ' features--show-element-staggering' -%}
  {%- endif -%}

  <body class="prestige--v4 {{ classes }} {% if template.directory %}template-{{ template.directory | handle }}{% endif %} template-{{ template.name | handle }} {% unless request.design_mode %}age-gate-loading{% endunless %}" data-age-gate-verified="{% if request.design_mode %}true{% else %}false{% endif %}">
    <a class="PageSkipLink u-visually-hidden" href="#main">{{ 'header.navigation.skip_to_content' | t }}</a>
    <span class="LoadingBar"></span>
    <div class="PageOverlay"></div>

    {%- if settings.show_page_transition -%}
      <div class="PageTransition"></div>
    {%- endif -%}

    {% section 'popup' %}
    {% section 'sidebar-menu' %}

    {%- if template != 'cart' -%}
      {% render 'cart-drawer' %}
    {%- endif -%}

    <div class="PageContainer">
      {% section 'announcement' %}
      {% section 'header' %}
      <div id="age-gate-section">
      {% section 'age-gate' %}
      </div>
      
      <div id="page-content">
        <main id="main" role="main">
          {{ content_for_layout }}
        </main>
        {% if template.name != 'index' %}
          {% section 'footer' %}
        {% endif %}
        {% if template.name == 'index' %}
          {% section 'new-footer-mobile' %}
        {% endif %}
        {% if template.name == 'index' %}
          {% section 'new-footer-desktop' %}
        {% endif %}
      </div>
    </div>
    
    <script>
      {% comment %} document.addEventListener('DOMContentLoaded', function() {
        const ageVerified = localStorage.getItem('agegateConfirmed_v1') === 'true';
        const body = document.body;
        const pageContent = document.getElementById('page-content');
        const ageGateSection = document.getElementById('age-gate-section');

        
        if (ageVerified || body.classList.contains('template-password')) {
          // If age is verified or it's the password page, show content and hide age gate
          if (pageContent) pageContent.style.display = 'block';
          if (ageGateSection) ageGateSection.style.display = 'none';
          body.classList.remove('age-gate-loading');
          body.setAttribute('data-age-gate-verified', 'true');
        } else {
          // Show age gate and hide content
          if (pageContent) pageContent.style.display = 'none';
          if (ageGateSection) ageGateSection.style.display = 'block';
          body.classList.add('age-gate-loading');
        }
      }); {% endcomment %}
    </script>
    {% render 'bookthatapp-widgets' %}
  </body>
</html>
