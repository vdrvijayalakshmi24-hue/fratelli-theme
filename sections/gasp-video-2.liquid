{% comment %}
  sections/first-video-and-content.liquid
  - Canvas-based video scrub section (user's FirstVideo) + content (FullSceenVideoContent).
  - Fixes and scopes GSAP animations for the "jason-second" content.
  - Video src: {{ 'Video_2.mp4' | asset_url }}
  - TRACK_VH = 250 (section height).
  - STEP = 1/30 (30 fps).
  - Schema max_blocks: 1.
{% endcomment %}

<section id="second-video-section-{{ section.id }}" class="second-video-section" data-section-id="{{ section.id }}">
  <style>
    /* ---------- Layout / scrub section ---------- */
    .second-vd-wrapper {
      position: relative;
      height: 250vh; /* TRACK_VH */
      width: 100%;
      overflow: visible;
      box-sizing: border-box;
      background: #000;
    }

    @media (min-width: 1024px) {
      .second-vd-wrapper {
        height: 300vh !important; /* TRACK_VH */
      }
    }

    .second-vd-pin {
      position: absolute; /* JS toggles absolute/fixed for reliable pin */
      top: 0;
      left: 0;
      right: 0;
      height: 100vh;
      width: 100%;
      z-index: 0;
      overflow: hidden;
      display: block;
      background: #000;
    }

    .second-vd-canvas {
      width: 100%;
      height: 100%;
      display: block;
      object-fit: cover;
      background: #000;
      image-rendering: auto;
    }

    .second-vd-video-decoder {
      position: absolute;
      opacity: 0;
      pointer-events: none;
      width: 1px;
      height: 1px;
      left: -9999px;
      top: -9999px;
    }

    /* spacer to ensure page can scroll */
    .second-vd-spacer {
      height: 1px;
    }

    /* ---------- Content area (converted from FullSceenVideoContent / Tailwind) ---------- */
    /* Container for the content â€” scoped by section id in DOM rather than CSS only */
    .second-video-content {
      position: relative;
      z-index: 10;
      box-sizing: border-box;
      width: 100%;
      overflow: hidden;
      padding: 0 1.5rem;
    }

    .jason-second {
      position: relative;
      z-index: 10;
      margin-top: 5rem; /* fallback vertical spacing if JS not applied */
      display: flex;
      flex-direction: column;
      gap: 1.25rem;
      overflow-x: hidden;
      width: 100vw;
      box-sizing: border-box;
      color: #FFFFF8;
      transform: translateY(40px); /* initial state */
      opacity: 0;                  /* initial state */
    }

    @media (min-width: 1024px) {
      .jason-second { flex-direction: row; padding-left: 10rem; }
    }

    .jason-second-content {
      max-width: 56rem; /* max-w-3xl approx */
      margin-bottom: 2.5rem;
    }

    .jason-second h1 {
      margin-top: 6rem; /* lowered to avoid overlapping pinned video */
      font-family: "Utile", sans-serif;
      text-transform: uppercase;
      margin-bottom: 2.5rem;
      color: #F4CF80;
      font-size: 44px;
      letter-spacing: 0;
    }

    .jason-second h2 {
      font-family: "Playfair Display", serif;
      margin-bottom: 1.75rem;
      padding-right: 5rem;
      color: #FFFFF8;
      font-size: 32px;
      font-style: italic;
      letter-spacing: -0.06em;
    }

    .jason-second p {
      font-family: system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
      padding-right: 7rem;
      color: #FFFFF8;
      font-size: 20px;
      letter-spacing: -0.04em;
    }

    .explore-btn-second {
      background: #fff;
      color: #000;
      border: none;
      padding: 0.625rem 1.25rem;
      border-radius: 20px;
      font-weight: 600;
      cursor: pointer;
    }

    /* Background gradient variations */
    .content-1-second {
      position: relative;
      display: block;
      background: linear-gradient(360deg, #1A0903 62.4%, rgba(0, 0, 0, 0) 97.16%);
      -webkit-mask-image: linear-gradient(to bottom, transparent 0%, black 30%, black 100%);
      mask-image: linear-gradient(to bottom, transparent 0%, black 15%, black 100%);
      box-sizing: border-box;
      padding: 0 2rem;
    }

    /* small helper for the image if provided */
    .full-image-second {
      width: 100%;
      height: 100vh;
      object-fit: cover;
      display: block;
    }
  </style>

  <!-- ========== Scrub section (canvas + hidden video) ========== -->
  <section
    class="second-vd-wrapper"
    id="second-vd-wrapper-{{ section.id }}"
    data-track-vh="250"
    >
    <div class="second-vd-pin mobile-only" id="second-vd-pin-mobile-{{ section.id }}">
      <canvas id="second-vd-canvas-mobile-{{ section.id }}" class="second-vd-canvas" role="img" aria-label="Video scrub"></canvas>
      <video
        id="second-vd-video-mobile-{{ section.id }}"
        class="second-vd-video-decoder"
        muted
        playsinline
        preload="auto"
        webkit-playsinline
        x-webkit-airplay="allow"
      >
        <source src="https://cdn.shopify.com/videos/c/o/v/adbca65253f3466ab81593e2f430e326.mp4" type="video/mp4" />
        Your browser does not support the video tag.
      </video>
    </div>
    <div class="second-vd-pin desktop-only" id="second-vd-pin-desktop-{{ section.id }}">
      <canvas id="second-vd-canvas-desktop-{{ section.id }}" class="second-vd-canvas" role="img" aria-label="Video scrub"></canvas>
      <video
        id="second-vd-video-desktop-{{ section.id }}"
        class="second-vd-video-decoder"
        muted
        playsinline
        preload="auto"
        webkit-playsinline
        x-webkit-airplay="allow"
      >
        <source src="https://cdn.shopify.com/videos/c/o/v/7ed7bbecce3442449c7d4edb655b31f9.mp4" type="video/mp4" />
        Your browser does not support the video tag.
      </video>
    </div>
    <div class="second-vd-spacer" aria-hidden="true"></div>
  </section>

  <!-- ========== Content area (converted from FullSceenVideoContent) ========== -->
  <section class="second-video-content content-1-second" id="second-video-content-{{ section.id }}">
    <div class="jason-second" id="jason-second-{{ section.id }}">
      <div class="jason-second-content">
        <h1 id="jason-second-h1-{{ section.id }}">Explore Range of Fratelli</h1>
        <h2 id="jason-second-h2-{{ section.id }}">From Akluj's Soil</h2>
        <p id="jason-second-p-{{ section.id }}">
          Their hands don't just plant vines. they planted a vision. they dont dont follow europe. they carved india into every bottle.
        </p>

        <div style="margin-top: 1.25rem;">
          <button type="button" class="explore-btn-second" id="jason-second-btn-{{ section.id }}">Explore</button>
        </div>
      </div>
    </div>
  </section>

  <script>
    (function() {
      var sectionId = '{{ section.id }}';
      var isMobile = window.innerWidth <= 767; // Match your mobile breakpoint
      var pinSuffix = isMobile ? 'mobile' : 'desktop';
      
      // Initialize video scrub using centralized utility
      if (window.FratelliGSAP && typeof window.FratelliGSAP.initVideoScrub === 'function') {
        const cleanupVideoScrub = window.FratelliGSAP.initVideoScrub({
          wrapperId: 'second-vd-wrapper-' + sectionId,
          pinId: 'second-vd-pin-' + pinSuffix + '-' + sectionId,
          canvasId: 'second-vd-canvas-' + pinSuffix + '-' + sectionId,
          videoId: 'second-vd-video-' + pinSuffix + '-' + sectionId,
          onReady: function(videoInfo) {
            console.log('Second video scrub initialized for section:', sectionId, 'on', pinSuffix);
            initContentAnimations();
          },
          onUpdate: function(progress, time) {
            // Optional: Add any progress-based updates here
          }
        });

        // Handle window resize
        function handleResize() {
          var newIsMobile = window.innerWidth <= 767;
          if (newIsMobile !== isMobile) {
            // If breakpoint is crossed, reload the section
            if (window.Shopify && window.Shopify.designMode) {
              window.location.reload();
            }
          }
        }

        // Add resize listener with debounce
        var resizeTimer;
        window.addEventListener('resize', function() {
          clearTimeout(resizeTimer);
          resizeTimer = setTimeout(handleResize, 250);
        });

        // Cleanup on section unload
        if (window.Shopify && window.Shopify.designMode) {
          window.addEventListener('shopify:section:unload', function cleanupOnUnload() {
            if (typeof cleanupVideoScrub === 'function') {
              cleanupVideoScrub();
            }
            window.removeEventListener('resize', handleResize);
            window.removeEventListener('shopify:section:unload', cleanupOnUnload);
          });
        }
      } else {
        console.warn('FratelliGSAP utilities not available');
      }

      // Initialize content animations using centralized utility
      function initContentAnimations() {
        const contentSection = document.getElementById('second-video-content-' + sectionId);
        if (!contentSection) return;
        
        const jasonSecond = contentSection.querySelector('#jason-second-' + sectionId) || contentSection.querySelector('.jason-second');
        const content1 = contentSection.classList.contains('content-1-second') ? 
          contentSection : contentSection.querySelector('.content-1-second') || contentSection;
        
        // Set initial margin
        const hasImage = !!contentSection.querySelector('.full-image-second');
        const initialMargin = hasImage ? '-15vh' : '-62vh';
        try { content1.style.marginTop = initialMargin; } catch (e) {}
        
        // Animate content using centralized utility
        if (window.FratelliGSAP && typeof window.FratelliGSAP.animateFadeIn === 'function') {
          window.FratelliGSAP.animateFadeIn(jasonSecond);
        } else {
          // Fallback if utility not available
          jasonSecond.style.opacity = '1';
          jasonSecond.style.transform = 'translateY(0)';
        }
      }
    })();
  </script>

  {% schema %}
  {
    "name": "Second Video Canvas Scrub",
    "settings": [],
    "blocks": [],
    "max_blocks": 1,
    "presets": [
      {
        "name": "Second Video Canvas Scrub"
      }
    ]
  }
  {% endschema %}
</section>
