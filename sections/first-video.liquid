{% comment %}
sections/scrolly-video-first-video-fixed.liquid
- Duplicated from scrolly-video-three-fixed-2.liquid
- Uses new video source: https://cdn.shopify.com/videos/c/o/v/49f4e96f0c8a43fa90adad4efeaa9e52.mp4
- All class names renamed to prevent conflicts.
{% endcomment %}

<section class="sv-first-video-section" id="sv4-first-video-{{ section.id }}">
  <style>
    .sv-first-video-section {
      position: relative;
      height: 200vh;         /* scroll length */
      overflow: visible;
      isolation: isolate;
      background: #000;      /* safety background so it’s never blank */
    }

    /* Underlay container (we’ll sticky its child video/canvas) */
    .sv4-video-first-video {
      position: relative;
      z-index: 1;
      min-height: 100vh;     /* ensure presence even before JS runs */
    }
    /* Fallback/sticky behavior */
    .sv4-video-first-video video,
    .sv4-video-first-video canvas {
      position: sticky;
      top: 0;
      width: 100%;
      height: 100vh;
      display: block;
      object-fit: cover;
      z-index: 1 !important;
      background: #000;
    }

    /* ---------- Overlay (kept visible; only inner fades) ---------- */
    .fratelli-video-first-video-scrub__content {
      position: absolute;
      bottom: 0;
      width: 100%;
      z-index: 10;
      padding: 20px;

      /* DO NOT hide the whole overlay—only fade the inner */
      pointer-events: auto;
      transform: translateY(0);
      display: flex;
      align-items: flex-end;
      text-align: center;
    }

    @media (min-width: 1024px) {
      .fratelli-video-first-video-scrub__content {
        padding: 0 !important;
      }
    }

    .fratelli-video-first-video-scrub__content-inner {
      max-width: 56rem;
      margin: 30px 0;
      opacity: 0; /* GSAP will fade this in/out */
      width: 100%;
    }

    .fratelli-video-first-video-scrub__container {
      width: 100%;
    }

    .fratelli-video-first-video-scrub__container h1 {
      font-family: "Utile", sans-serif; color: #ffffff;
      font-size: 36px; font-weight: 600;
    }
    .fratelli-video-first-video-scrub__content-inner {
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
    }
    @media (min-width: 1024px) {
      .fratelli-video-first-video-scrub__content-inner {
        flex-direction: row;
        justify-content: flex-start;
        gap: 20px;
      }
    }
    .fratelli-video-first-video-scrub__container p {
      font-family: system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
      color: #FFFFF8; font-size: 16px; letter-spacing: -0.04em;
    }
    .fratelli-video-first-video-scrub__explore-btn {
      background: #fff; color: #000; border: none; padding: 0.625rem 1.25rem;
      border-radius: 20px; font-weight: 600; cursor: pointer;
    }

    /* Optional “near bottom” styling */
    .fratelli-video-first-video-scrub__content.is-section-bottom {
      background: linear-gradient(0deg, #181C0F 74.42%, rgba(0, 0, 0, 0) 97.16%);
      -webkit-mask-image: linear-gradient(to bottom, transparent 0%, black 30%, black 100%);
      mask-image: linear-gradient(to bottom, transparent 0%, black 15%, black 100%);
      border-radius: 12px 12px 0 0; padding: 24px 32px;
      -webkit-backdrop-filter: blur(6px); backdrop-filter: blur(6px);
      height: 50%;
    }

    @media (min-width: 1024px) {
      .fratelli-video-first-video-scrub__content.is-section-bottom {
        height: 35%;
      }
    }

    .text-section {
      text-align: left;
    }

    @media (max-width: 768px) {
      .fratelli-video-first-video-scrub__container h1 { font-size: 28px; margin-top: 3rem; }
      .fratelli-video-first-video-scrub__container p { font-size: 16px; padding-right: 0; }
      .fratelli-video-first-video-scrub__content.is-section-bottom { padding: 16px 20px; border-radius: 8px 8px 0 0; }
    }
  </style>

  <!-- Underlay -->
  <div id="scrolly-video4-{{ section.id }}" class="sv4-video-first-video"></div>

  <div class="fratelli-video-first-video-scrub__content" data-over-content id="sv4-overlay-first-video-{{ section.id }}">
    <div class="fratelli-video-first-video-scrub__container">
      <div class="fratelli-video-first-video-scrub__content-inner" id="sv4-inner-first-video-{{ section.id }}">
        <div class="image-section">
          <img width="100%" height="auto" src="https://cdn.shopify.com/s/files/1/0491/6628/7016/files/Section_1.jpg?v=1758619356" alt="Section_1" />
        </div>
        <div class="text-section">
          <h1 id="sv4-h1-first-video-{{ section.id }}">India's finest Wine Makers</h1>
          <p id="sv4-p1-first-video-{{ section.id }}">
            From the heart of Akluj to tables across the world, Fratelli is more than wine, it's a story of heritage, craftsmanship and seven brothers bound by a dream. Every bottle is a testament to passion and the spirit of Pour More Into Life.
          </p>
          <div style="margin-top: 1.25rem;">
            <button type="button"  class="fratelli-video-first-video-scrub__explore-btn" id="sv4-first-video-btn-{{ section.id }}">DISCOVER OUR STORY</button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <script>
    (function () {
      var sectionId   = "{{ section.id }}";
      var containerId = "scrolly-video4-" + sectionId;
      var overlaySel  = "#sv4-overlay-first-video-" + sectionId;
      var innerSel    = "#sv4-inner-first-video-" + sectionId;
      var SHOW_THRESHOLD = 0.5, HIDE_THRESHOLD = 0.1;
      var videoSrc = "https://cdn.shopify.com/videos/c/o/v/aa8ea38fecb6431ebc55c842becc04eb.mp4";

      var overlayEl = document.querySelector(overlaySel);
      var innerEl   = document.querySelector(innerSel);
      var holder    = document.getElementById(containerId);

      // --- 1) Try ScrollyVideo; else inject a sticky <video> fallback so the section is never blank ---
      var scrollyInitOk = false;
      try {
        if (window.ScrollyVideo) {
          new ScrollyVideo({
            scrollyVideoContainer: containerId,
            src: videoSrc,
            cover: true,
            onChange: function (progress) {
              if (overlayEl) {
                if (progress >= SHOW_THRESHOLD) {
                  if (!overlayEl.classList.contains('is-section-bottom')) {
                    overlayEl.classList.add('is-section-bottom');
                    var btn = overlayEl.querySelector('button, a'); if (btn) btn.setAttribute('tabindex','0');
                  }
                } else if (progress < HIDE_THRESHOLD) {
                  if (overlayEl.classList.contains('is-section-bottom')) {
                    overlayEl.classList.remove('is-section-bottom');
                    var btn2 = overlayEl.querySelector('button, a'); if (btn2) btn2.setAttribute('tabindex','-1');
                  }
                }
              }
            }
          });
          scrollyInitOk = true;
        }
      } catch (e) {
        console.warn("[SV4] ScrollyVideo error:", e);
      }

      if (!scrollyInitOk && holder) {
        var v = document.createElement('video');
        v.src = videoSrc;
        v.playsInline = true;
        v.muted = true;
        v.autoplay = true;
        v.loop = true;
        v.setAttribute('webkit-playsinline', 'true');
        holder.appendChild(v);
        v.addEventListener('error', function(){ console.warn('[SV4] Fallback video failed to load'); });
      }

      // --- 2) GSAP ScrollTrigger: fade ONLY the inner content (no scrub) ---
      if (window.gsap && window.ScrollTrigger && innerEl) {
        gsap.registerPlugin(ScrollTrigger);
        gsap.set(innerEl, { opacity: 0 });

        gsap.to(innerSel, {
          scrollTrigger: {
            trigger: overlaySel,
            start: 'top 50%',
            end: 'top 20%',
            scrub: false,
            markers: false,
            onEnter: () => {
              gsap.to(innerSel, {
                opacity: 1,
                duration: 0.6,
                ease: 'power2.out'
              });
            },
            onLeaveBack: () => {
              gsap.to(innerSel, {
                opacity: 0,
                duration: 0.6,
                ease: 'power2.in'
              });
            }
          }
        });
      } else {
        console.warn('[SV4] GSAP/ScrollTrigger missing — inner fade skipped.');
      }
    })();
  </script>
</section>
