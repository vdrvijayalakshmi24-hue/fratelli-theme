{% comment %}
  sections/first-video-and-content-duplicate-2.liquid
  - Duplicate of first-video-and-content-duplicate with all classnames / ids / selectors renamed (prefix: dup2- / jason-dup2)
  - Canvas-based video scrub section + content.
  - VIDEO SRC unchanged from provided code (Vineyards_Drone_Mobile.mp4).
  - TRACK_VH = 250 (section height).
  - STEP = 1/30 (30 fps).
  - Schema max_blocks: 1.
{% endcomment %}

<section id="dup2-video-section-{{ section.id }}" class="dup2-video-section" data-section-id="{{ section.id }}">
    <style>
      /* ---------- Layout / scrub section ---------- */
      .dup2-vd-wrapper {
        position: relative;
        height: 300vh; /* TRACK_VH */
        width: 100%;
        overflow: visible;
        box-sizing: border-box;
        background: #000;
      }

      @media (min-width: 1024px) {
        .dup2-vd-wrapper {
          height: 200vh !important; /* TRACK_VH */
        }
      }
  
      .dup2-vd-pin {
        position: absolute; /* JS toggles absolute/fixed for reliable pin */
        top: 0;
        left: 0;
        right: 0;
        height: 100vh;
        width: 100%;
        z-index: 0;
        overflow: hidden;
        display: block;
        background: #000;
      }
  
      .dup2-vd-canvas {
        width: 100%;
        height: 100%;
        display: block;
        object-fit: cover;
        background: #000;
        image-rendering: auto;
      }
  
      .dup2-vd-video-decoder {
        position: absolute;
        opacity: 0;
        pointer-events: none;
        width: 1px;
        height: 1px;
        left: -9999px;
        top: -9999px;
      }
  
      /* spacer to ensure page can scroll */
      .dup2-vd-spacer { height: 1px; }
  
      /* ---------- Content area ---------- */
      .dup2-video-content {
        position: relative;
        z-index: 10;
        box-sizing: border-box;
        width: 100%;
        overflow: hidden;
        padding: 0 1.5rem;
      }
  
      .jason-dup2 {
        position: relative;
        z-index: 10;
        margin-top: 5rem;
        display: flex;
        flex-direction: column;
        gap: 1.25rem;
        overflow-x: hidden;
        width: 100vw;
        box-sizing: border-box;
        color: #FFFFF8;
        transform: translateY(40px);
        opacity: 0;
      }
  
      @media (min-width: 1024px) { .jason-dup2 { flex-direction: row; padding-left: 10rem; } }
  
      .jason-dup2-content { max-width: 56rem; margin-bottom: 2.5rem; }
  
      .jason-dup2 h1 {
        margin-top: 6rem;
        font-family: "Utile", sans-serif;
        text-transform: uppercase;
        margin-bottom: 2.5rem;
        color: #F4CF80;
        font-size: 44px;
      }
  
      .jason-dup2 h2 {
        font-family: "Playfair Display", serif;
        margin-bottom: 1.75rem;
        padding-right: 5rem;
        color: #FFFFF8;
        font-size: 32px;
        font-style: italic;
      }
  
      .jason-dup2 p {
        font-family: system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
        padding-right: 7rem;
        color: #FFFFF8;
        font-size: 20px;
      }
  
      .explore-btn-dup2 {
        background: #fff;
        color: #000;
        border: none;
        padding: 0.625rem 1.25rem;
        border-radius: 20px;
        font-weight: 600;
        cursor: pointer;
      }
  
      .content-1-dup2 {
        position: relative;
        display: block;
        background: linear-gradient(0deg, #34461A 74.46%, rgba(0, 0, 0, 0) 100%);
        -webkit-mask-image: linear-gradient(to bottom, transparent 0%, black 30%, black 100%);
        mask-image: linear-gradient(to bottom, transparent 0%, black 30%, black 100%);
        box-sizing: border-box;
        padding: 0 2rem;
      }
  
      .full-image-dup2 { width: 100%; height: 100vh; object-fit: cover; display: block; }
    </style>
  
    <!-- Scrub section -->
    <section
      class="dup2-vd-wrapper"
      id="dup2-vd-wrapper-{{ section.id }}"
      data-track-vh="250"
      >
      <div class="dup2-vd-pin" id="dup2-vd-pin-{{ section.id }}">
        <canvas id="dup2-vd-canvas-{{ section.id }}" class="dup2-vd-canvas" role="img" aria-label="Video scrub"></canvas>
        <video
          id="dup2-vd-video-{{ section.id }}"
          class="dup2-vd-video-decoder"
          muted
          playsinline
          preload="auto"
          webkit-playsinline
          x-webkit-airplay="allow"
        >
          <source src="https://cdn.shopify.com/videos/c/o/v/9d0d7db685a0498da3add0992dd7b8ea.mp4" type="video/mp4" />
          Your browser does not support the video tag.
        </video>
      </div>
      <div class="dup2-vd-spacer" aria-hidden="true"></div>
    </section>
  
    <!-- Content area -->
    <section class="dup2-video-content content-1-dup2" id="dup2-video-content-{{ section.id }}">
      <div class="jason-dup2" id="jason-dup2-{{ section.id }}">
        <div class="jason-dup2-content">
          <h1 id="jason-dup2-h1-{{ section.id }}">Explore Range of Fratelli</h1>
          <h2 id="jason-dup2-h2-{{ section.id }}">From Akluj's Soil</h2>
          <p id="jason-dup2-p-{{ section.id }}">Their hands don't just plant vines. they planted a vision. they dont dont follow europe. they carved india into every bottle.</p>
          <div style="margin-top: 1.25rem;"><button type="button" class="explore-btn-dup2" id="jason-dup2-btn-{{ section.id }}">Explore</button></div>
        </div>
      </div>
    </section>
  
    <script>
      (function() {
        var sectionId = '{{ section.id }}';
        var isMobile = window.innerWidth <= 767; // Match your mobile breakpoint
        var pinSuffix = isMobile ? 'mobile' : 'desktop';
        var videoInitialized = false;
        var cleanupVideoScrub = null;
        
        function initializeVideoScrub() {
          console.log('initializeVideoScrub called for fratelli-building-mobile');
          if (videoInitialized) {
            console.log('Video already initialized, skipping');
            return;
          }
          videoInitialized = true;
          
          // Log video element status
          const videoElement = document.getElementById('dup2-vd-video-' + sectionId);
          console.log('Video element:', {
            exists: !!videoElement,
            readyState: videoElement?.readyState,
            currentTime: videoElement?.currentTime,
            duration: videoElement?.duration,
            paused: videoElement?.paused
          });
          
          // Initialize video scrub using centralized utility
          if (window.FratelliGSAP && typeof window.FratelliGSAP.initVideoScrub === 'function') {
            console.log('Initializing video scrub with FratelliGSAP');
            try {
              cleanupVideoScrub = window.FratelliGSAP.initVideoScrub({
                wrapperId: 'dup2-vd-wrapper-' + sectionId,
                pinId: 'dup2-vd-pin-' + sectionId,
                canvasId: 'dup2-vd-canvas-' + sectionId,
                videoId: 'dup2-vd-video-' + sectionId,
                onReady: function(videoInfo) {
                  console.log('Fratelli building mobile video scrub initialized for section:', sectionId, 'Video info:', videoInfo);
                  initContentAnimations();
                },
                onUpdate: function(progress, time) {
                  // Optional: Add any progress-based updates here
                  console.log('Video progress:', { progress, time });
                },
                onError: function(error) {
                  console.error('Error initializing video scrub:', error);
                }
              });
              console.log('Video scrub initialization started');
            } catch (error) {
              console.error('Error in initVideoScrub:', error);
            }
          } else {
            console.warn('FratelliGSAP utilities not available', {
              FratelliGSAP: !!window.FratelliGSAP,
              initVideoScrub: window.FratelliGSAP ? typeof window.FratelliGSAP.initVideoScrub : 'no FratelliGSAP'
            });
          }
        }

        // Initialize content animations using centralized utility
        function initContentAnimations() {
          const contentSection = document.getElementById('dup2-video-content-' + sectionId);
          if (!contentSection) {
            console.error('Content section not found');
            return;
          }
          
          const jasonDup2 = contentSection.querySelector('#jason-dup2-' + sectionId) || contentSection.querySelector('.jason-dup2');
          if (!jasonDup2) {
            console.error('jason-dup2 element not found');
            return;
          }
          
          // Set initial margin (adjust these values as needed)
          const hasImage = !!contentSection.querySelector('.full-image-dup2');
          const initialMargin = hasImage ? '-15vh' : '-62vh';
          try { 
            contentSection.style.marginTop = initialMargin; 
          } catch (e) {
            console.error('Error setting margin:', e);
          }
          
          // Animate content using centralized utility if available
          if (window.FratelliGSAP && typeof window.FratelliGSAP.animateFadeIn === 'function') {
            window.FratelliGSAP.animateFadeIn(jasonDup2);
          } else {
            // Fallback if utility not available
            jasonDup2.style.opacity = '1';
            jasonDup2.style.transform = 'translateY(0)';
            jasonDup2.style.transition = 'opacity 0.8s ease-out, transform 0.8s ease-out';
          }
        }

        // Initialize immediately if page content is already visible
        if (document.getElementById('page-content')?.style.display !== 'none') {
          initializeVideoScrub();
        }
        
        // Also initialize when page content is shown
        document.addEventListener('pageContentShown', initializeVideoScrub);

        // Handle window resize
        function handleResize() {
          var newIsMobile = window.innerWidth <= 767;
          if (newIsMobile !== isMobile) {
            // If breakpoint is crossed, reload the section
            if (window.Shopify && window.Shopify.designMode) {
              window.location.reload();
            }
          }
        }

        // Add resize listener with debounce
        var resizeTimer;
        window.addEventListener('resize', function() {
          clearTimeout(resizeTimer);
          resizeTimer = setTimeout(handleResize, 250);
        });

        // Cleanup on section unload
        if (window.Shopify && window.Shopify.designMode) {
          window.addEventListener('shopify:section:unload', function cleanupOnUnload() {
            if (typeof cleanupVideoScrub === 'function') {
              cleanupVideoScrub();
            }
            window.removeEventListener('resize', handleResize);
            document.removeEventListener('pageContentShown', initializeVideoScrub);
            window.removeEventListener('shopify:section:unload', cleanupOnUnload);
          });
        }
      })();
    </script>
  
    {% schema %}
    {
      "name": "Duplicate Video Copy",
      "settings": [],
      "blocks": [],
      "max_blocks": 1,
      "presets": [ { "name": "Duplicate Video Copy" } ]
    }
    {% endschema %}
  </section>
  